<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP with java script(crud Employee)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
</head>
<body>
    <!-- bs5-grid-container -->
<div class="container">
    <br/>
    <!-- bs5-grid-row -->
    <div class="row">

        <!-- bs5-modal-default "SOLO PARA EDITAR"-->
        <!-- Modal -->
        <div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <form action="javascript:void(0);" method="post" onsubmit="aplication.Update()">

                        <div class="modal-header">
                            <h5 class="modal-title">Edit Employee</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <div class="mb-3">
                            <label for="" class="form-label">Id</label>
                            <input readonly type="text"
                                class="form-control" name="idEdit" id="idEdit" aria-describedby="helpId" placeholder="Id of employee">
                            </div>
                            <!-- bs5-form-input -->
                            <div class="mb-3">
                                <label for="" class="form-label">Name:</label>
                                <input required type="text"
                                class="form-control" names="namesEdit" id="namesEdit" aria-describedby="helpId" placeholder="Name of Employee">
                            </div>
                            <div class="mb-3">
                                <label for="" class="form-label">Email:</label>
                                <input required type="email" class="form-control" names="emailEdit" id="emailEdit" aria-describedby="emailHelpId" placeholder="Email of Employee">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Update</button>
                        </div>
                    
                    </form>

                </div>
            </div>
        </div>
        <!-- bs5-modal-default "SOLO PARA EDITAR"-->

        <!-- bs5-grid-col -->
        <div class="col-md-5">

            <!-- BS5-CARD-HEAD-FOOT -->
            <div class="card">
                <div class="card-header">
                    EMPLOYEE
                </div>
                <div class="card-body">

                    <!-- form:post -->
                    <form action="javascript:void(0);" method="post" onsubmit="aplication.Add()">

                        <!-- bs5-form-input -->
                        <div class="mb-3">
                          <label for="" class="form-label">Name:</label>
                          <input required type="text"
                            class="form-control" names="names" id="names" aria-describedby="helpId" placeholder="Name of Employee">
                        </div>

                        <div class="mb-3">
                          <label for="" class="form-label">Email:</label>
                          <input required type="email" class="form-control" names="email" id="email" aria-describedby="emailHelpId" placeholder="Email of Employee">
                       </div>

                       <!-- bs5-button-default -->
                       <button type="submit" class="btn btn-success">Add Employee</button>

                    </form>

                </div>

            </div>

        </div>

        <div class="col-md-7">
            <!-- BS5-TABLE-DEFAULT -->
            <table class="table">
                <thead>
                    <tr>
                        <th>ID:</th>
                        <th>Name:</th>
                        <th>Email:</th>
                        <th>Actions:</th>

                    </tr>
                </thead>
                <tbody id="employees">
                    <!-- bs5-bgroup-default " para los botones" --> 
                   

                    </div>


                </tbody>
            </table>
            
        </div>
        
    </div>
    
</div>

<script>
    //consumiendo de php index
    var url="http://localhost/appjavascript/";
    //consumiendo de php index

    //consumiendo de modal VENTANA PARA EDITAR
    var modal=new bootstrap.Modal(document.getElementById('modelId'), {keyboard:false});
      //consumiendo de modal VENTANA PARA EDITAR

    var aplication= new function(){
        //edit Model
        this.idEdit=document.getElementById("idEdit");
        this.namesEdit=document.getElementById("namesEdit");
        this.emailEdit=document.getElementById("emailEdit");
        //edit Model

        this.names=document.getElementById("names");
        this.email=document.getElementById("email");

        this.employees=document.getElementById("employees");

        this.Read= function(){
            var data="";

            fetch(url)
            .then(r=>r.json())
            .then((answer)=>{

                console.log(answer);

                answer.map(

                    function(Employee,index,array){
                        data+="<tr>";

                        data+="<td>"+Employee.id+"</td>";
                        data+="<td>"+Employee.names+"</td>";                       
                        data+="<td>"+Employee.email+"</td>";
                        data+='<td><button type="submit" class="btn btn-info" onclick="aplication.Edit('+Employee.id+')" >Edit</button> <button type="submit" class="btn btn-danger"  onclick="aplication.Delete('+Employee.id+')" >Delete</button></div>'+'</td>';
                        
                        data+="</tr>";
                
                    }
                );
                return this.employees.innerHTML=data;

            })                        
            
            .catch(console.log);

            //data="<td>1</td> <td>OSCAR</td> <td>OSCAR@GMAIL.COM</td> <td>EDIT | DELETE</td>";
            
        };
        this.Add=function(){
            console.log(names.value);
            console.log(email.value);

            var dataSend={names:this.names.value,email:this.email.value}

            fetch(url+"?add=1",{method:"POST",body:JSON.stringify(dataSend)})
            .then(answer=>answer.json())
            .then((dataAnswer)=>{
                console.log("Insertando");
                this.Read();

            })
            .catch(console.log);
        
        };
        this.Delete=function(id){
            console.log(id);

            fetch(url+"?delete="+id)
            .then(answer=>answer.json())
            .then((dataAnswer)=>{

                this.Read();

            })
            .catch(console.log);

        }
        this.Edit=function(id){

            console.log(id);

            fetch(url+"?search="+id)
            .then(answer=>answer.json())
            .then((dataAnswer)=>{
                console.log(dataAnswer);
                this.idEdit.value=dataAnswer[0]['id'];
                this.namesEdit.value=dataAnswer[0]['names'];
                this.emailEdit.value=dataAnswer[0]['email'];

            })
            .catch(console.log);

            modal.show();

        }
        this.Update=function(id){

            var dataSend={id:this.idEdit.value,names:this.namesEdit.value,email:this.emailEdit.value}

            fetch(url+"?update=1",{method:"POST",body:JSON.stringify(dataSend)})
            .then(answer=>answer.json())
            .then((dataAnswer)=>{
                console.log("Edit in this moment");
                this.Read();
                modal.hide();

            })
            .catch(console.log);

 
        }
    }
    

    aplication.Read();
</script>

</body>
</html>
